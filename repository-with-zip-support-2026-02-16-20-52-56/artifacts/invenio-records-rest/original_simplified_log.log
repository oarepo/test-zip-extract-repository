 rabbitmq Pulling 
 opensearch Pulling 
 postgresql Pulling 
 redis Pulling 
 4f4fb700ef54 Already exists 
 4f4fb700ef54 Already exists 
 redis Pulled 
 rabbitmq Pulled 
 postgresql Pulled 
 opensearch Pulled 
 Network docker_services_cli_default  Creating
 Network docker_services_cli_default  Created
 Container docker_services_cli-opensearch-1  Creating
 Container docker_services_cli-postgresql-1  Creating
 Container docker_services_cli-redis-1  Creating
 Container docker_services_cli-rabbitmq-1  Creating
 Container docker_services_cli-postgresql-1  Created
 Container docker_services_cli-redis-1  Created
 Container docker_services_cli-rabbitmq-1  Created
 Container docker_services_cli-opensearch-1  Created
 Container docker_services_cli-opensearch-1  Starting
 Container docker_services_cli-postgresql-1  Starting
 Container docker_services_cli-redis-1  Starting
 Container docker_services_cli-rabbitmq-1  Starting
 Container docker_services_cli-rabbitmq-1  Started
 Container docker_services_cli-opensearch-1  Started
 Container docker_services_cli-redis-1  Started
 Container docker_services_cli-postgresql-1  Started
============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original
configfile: setup.cfg
testpaths: docs, tests, invenio_records_rest
plugins: isort-4.0.0, flask-1.3.0, black-ng-0.4.1, invenio-3.4.2, github-actions-annotate-failures-0.3.0, pydocstyle-2.4.0, cov-7.0.0, pycodestyle-2.5.0
collected 131 items
tests/test_custom_endpoints.py 
                                        [  1%]
tests/test_custom_fields.py 
                                           [  3%]
tests/test_error_handlers.py 
                                           [  3%]
tests/test_ext.py ..                                                     [  5%]
tests/test_facets.py 
                                         [ 13%]
tests/test_index_prefixing.py 
                                         [ 15%]
tests/test_links.py 
                                                   [ 16%]
tests/test_marshmallow_contrib.py ...                                    [ 19%]
tests/test_marshmallow_loader.py 
                                  [ 23%]
tests/test_permissions.py 
                                              [ 24%]
tests/test_pid_resolver.py 
                                             [ 25%]
tests/test_serializer_base.py 
                                         [ 26%]
tests/test_serializer_citeproc.py 
                                   [ 29%]
tests/test_serializer_csv.py 
                                         [ 32%]
tests/test_serializer_datacite.py 
                                   [ 35%]
tests/test_serializer_dc.py 
                                           [ 36%]
tests/test_serializer_json.py 
                                        [ 38%]
tests/test_serializer_jsonld.py 
                                       [ 40%]
tests/test_serializer_marshmallow.py 
                                 [ 42%]
tests/test_serializer_response.py 
                                     [ 44%]
tests/test_sorter.py 
                                             [ 49%]
tests/test_utils.py 
                                               [ 54%]
tests/test_views_item_delete.py 
                                     [ 57%]
tests/test_views_item_get.py 
                                        [ 60%]
tests/test_views_item_patch.py 
                                  [ 66%]
tests/test_views_item_put.py 
                                  [ 74%]
tests/test_views_list_post.py 
                                   [ 80%]
tests/test_views_options.py 
                                           [ 81%]
tests/test_views_search.py 
                          [ 96%]
tests/test_views_serializers.py 
                                       [ 98%]
tests/test_views_suggesters.py 
                                         [ 99%]
invenio_records_rest/__init__.py 
                                       [100%]
=============================== warnings summary ===============================
venv/lib/python3.14/site-packages/invenio_records/resolver.py:14
venv/lib/python3.14/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver
venv/lib/python3.14/site-packages/invenio_records/resolver.py:14
venv/lib/python3.14/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver
venv/lib/python3.14/site-packages/webargs/compat.py:8
    MARSHMALLOW_VERSION_INFO = tuple(LooseVersion(ma.__version__).version)  # type: tuple
venv/lib/python3.14/site-packages/webargs/compat.py:8
    MARSHMALLOW_VERSION_INFO = tuple(LooseVersion(ma.__version__).version)  # type: tuple
venv/lib/python3.14/site-packages/webargs/__init__.py:13
    __version_info__ = tuple(LooseVersion(__version__).version)
invenio_records_rest/serializers/citeproc.py:57
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/invenio_records_rest/serializers/citeproc.py:57: RemovedInMarshmallow4Warning: The 'missing' argument to fields is deprecated. Use 'load_default' instead
    "style": fields.Str(missing=_default_style),
invenio_records_rest/serializers/citeproc.py:58
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/invenio_records_rest/serializers/citeproc.py:58: RemovedInMarshmallow4Warning: The 'missing' argument to fields is deprecated. Use 'load_default' instead
    "locale": fields.Str(missing=_default_locale),
venv/lib/python3.14/site-packages/datacite/rest_client.py:23
    from idutils import normalize_doi
venv/lib/python3.14/site-packages/datacite/jsonutils.py:15
venv/lib/python3.14/site-packages/datacite/jsonutils.py:15
    from jsonschema import RefResolver, validate
venv/lib/python3.14/site-packages/pyld/jsonld.py:4413
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/pyld/jsonld.py:4413: SyntaxWarning: "\?" is an invalid escape sequence. Such sequences will not work in the future. Did you mean "\\?"? A raw string is also an option
    and re.match('.*[:/\?#\[\]@]$', id_)
venv/lib/python3.14/site-packages/pyld/jsonld.py:577
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/pyld/jsonld.py:577: SyntaxWarning: "is" with 'int' literal. Did you mean "=="?
    if len(output) is 1 and output[0] == '':
    self.init_app(app)
    warnings.warn(
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/invenio_records/api.py:335: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/tests/helpers.py:30: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/invenio_records_rest/serializers/marshmallow.py:26: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    return self.schema_class(context=context).dump(obj).data
    return self.schema_class(context=context).dump(obj).data
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/marshmallow/fields.py:986: RemovedInMarshmallow4Warning: Passing field metadata as keyword arguments is deprecated. Use the explicit `metadata=...` argument instead. Additional metadata: {'load_from': 'from'}
    super().__init__(**kwargs)
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/marshmallow/fields.py:986: RemovedInMarshmallow4Warning: The 'missing' argument to fields is deprecated. Use 'load_default' instead
    super().__init__(**kwargs)
tests/test_custom_fields.py::test_load_custom_fields
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/tests/test_custom_fields.py:80: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    loaded_data = CustomFieldSchema(context={"pid": recid}).load(rec).data
tests/test_custom_fields.py::test_load_custom_fields
    loaded_data = CustomFieldSchema(context={"pid": recid}).load(rec).data
tests/test_custom_fields.py::test_custom_generated_fields
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/marshmallow/fields.py:2005: RemovedInMarshmallow4Warning: The 'missing' argument to fields is deprecated. Use 'load_default' instead
    super().__init__(**kwargs)
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema().load({}).data == {}
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema().dump({}).data == {}
tests/test_custom_fields.py::test_custom_generated_fields
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/tests/test_custom_fields.py:152: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    assert GeneratedFieldsSchema(context=ctx).load({}).data == {
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema(context=ctx).load({}).data == {
tests/test_custom_fields.py::test_custom_generated_fields
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/tests/test_custom_fields.py:156: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    assert GeneratedFieldsSchema(context=ctx).dump({}).data == {
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema(context=ctx).dump({}).data == {
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema().load(data).data == {
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema().dump(data).data == {
tests/test_custom_fields.py::test_custom_generated_fields
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/tests/test_custom_fields.py:172: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    assert GeneratedFieldsSchema(context=ctx).load(data).data == {
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema(context=ctx).load(data).data == {
tests/test_custom_fields.py::test_custom_generated_fields
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/tests/test_custom_fields.py:176: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    assert GeneratedFieldsSchema(context=ctx).dump(data).data == {
tests/test_custom_fields.py::test_custom_generated_fields
    assert GeneratedFieldsSchema(context=ctx).dump(data).data == {
    target.updated = datetime.utcnow()
tests/test_index_prefixing.py::test_api_views
tests/test_views_item_delete.py::test_valid_delete
tests/test_views_item_delete.py::test_delete_deleted
tests/test_views_item_delete.py::test_delete_with_sqldatabase_error
tests/test_views_item_patch.py::test_patch_deleted[application/json-patch+json]
tests/test_views_item_patch.py::test_patch_deleted[application/json-patch+json;charset=utf-8]
tests/test_views_item_put.py::test_put_on_deleted[application/json]
tests/test_views_item_put.py::test_put_on_deleted[application/json;charset=utf-8]
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/invenio_records/api.py:496: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():
    target.updated = datetime.utcnow()
tests/test_marshmallow_loader.py::test_marshmallow_load
tests/test_marshmallow_loader.py::test_marshmallow_load
tests/test_marshmallow_loader.py::test_json_pid_checker_loader
    return result.data
tests/test_marshmallow_loader.py::test_marshmallow_load
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/invenio_records_rest/loaders/marshmallow.py:94: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    result = schema_class(context=context).load(request_json)
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/invenio_records/api.py:443: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():
tests/test_marshmallow_loader.py::test_marshmallow_load_nested_errors
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/invenio_records_rest/schemas/json.py:57: RemovedInMarshmallow4Warning: `Field.fail` is deprecated. Use `raise self.make_error("required", ...)` instead
    self.fail("required")
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-records-rest/original/.venv/lib/python3.14/site-packages/marshmallow/fields.py:631: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead
    self._schema = schema_class(
    warnings.warn(
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.14.2-final-0 ________________
Name                                                          Stmts   Miss  Cover   Missing
invenio_records_rest/__init__.py                                  4      0   100%
invenio_records_rest/_compat.py                                  11      5    55%   22-28
invenio_records_rest/config.py                                   29      0   100%
invenio_records_rest/errors.py                                  105     10    90%   51, 104-106, 187-189, 255-259
invenio_records_rest/ext.py                                      52      1    98%   112
invenio_records_rest/facets.py                                  103     22    79%   31-55, 121, 167-170, 189-192, 240
invenio_records_rest/links.py                                    13      0   100%
invenio_records_rest/loaders/__init__.py                          8      0   100%
invenio_records_rest/loaders/marshmallow.py                      45      5    89%   56, 86-88, 105
invenio_records_rest/proxies.py                                   4      0   100%
invenio_records_rest/query.py                                    25      3    88%   39-44
invenio_records_rest/schemas/__init__.py                          2      0   100%
invenio_records_rest/schemas/fields/__init__.py                   8      0   100%
invenio_records_rest/schemas/fields/datetime.py                  11      4    64%   21-24
invenio_records_rest/schemas/fields/generated.py                 23      7    70%   31-54
invenio_records_rest/schemas/fields/marshmallow_contrib.py       38      7    82%   19-20, 26, 76, 135-137
invenio_records_rest/schemas/fields/persistentidentifier.py       8      0   100%
invenio_records_rest/schemas/fields/sanitizedhtml.py             11      0   100%
invenio_records_rest/schemas/fields/sanitizedunicode.py          14      0   100%
invenio_records_rest/schemas/fields/trimmedstring.py              5      0   100%
invenio_records_rest/schemas/json.py                             61     27    56%   26-34, 67-74, 79-96, 113, 121-122
invenio_records_rest/serializers/__init__.py                      9      0   100%
invenio_records_rest/serializers/base.py                         37      7    81%   38, 53, 63, 85, 98, 117, 127
invenio_records_rest/serializers/citeproc.py                     62      5    92%   32-35, 109-110
invenio_records_rest/serializers/csv.py                          66      3    95%   54, 135, 139
invenio_records_rest/serializers/datacite.py                     43      0   100%
invenio_records_rest/serializers/dc.py                           15      0   100%
invenio_records_rest/serializers/json.py                         15      0   100%
invenio_records_rest/serializers/jsonld.py                       32      4    88%   45-48
invenio_records_rest/serializers/marshmallow.py                  20      0   100%
invenio_records_rest/serializers/response.py                     27      0   100%
invenio_records_rest/sorter.py                                   49      0   100%
invenio_records_rest/utils.py                                   100      1    99%   168
invenio_records_rest/views.py                                   339     13    96%   114-116, 127, 291, 296, 299, 440, 718, 723, 881, 924, 961
TOTAL                                                          1394    124    91%
===================== 131 passed, 1715 warnings in 30.71s ======================
 Container docker_services_cli-postgresql-1  Stopping
 Container docker_services_cli-redis-1  Stopping
 Container docker_services_cli-rabbitmq-1  Stopping
 Container docker_services_cli-opensearch-1  Stopping
 Container docker_services_cli-redis-1  Stopped
 Container docker_services_cli-redis-1  Removing
 Container docker_services_cli-redis-1  Removed
 Container docker_services_cli-postgresql-1  Stopped
 Container docker_services_cli-postgresql-1  Removing
 Container docker_services_cli-postgresql-1  Removed
 Container docker_services_cli-opensearch-1  Stopped
 Container docker_services_cli-opensearch-1  Removing
 Container docker_services_cli-opensearch-1  Removed
 Container docker_services_cli-rabbitmq-1  Stopped
 Container docker_services_cli-rabbitmq-1  Removing
 Container docker_services_cli-rabbitmq-1  Removed
 Network docker_services_cli_default  Removing
 Network docker_services_cli_default  Removed
