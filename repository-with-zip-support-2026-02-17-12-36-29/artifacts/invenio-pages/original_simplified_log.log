 postgresql Pulling 
 redis Pulling 
 opensearch Pulling 
 4f4fb700ef54 Already exists 
 4f4fb700ef54 Already exists 
 redis Pulled 
 postgresql Pulled 
 opensearch Pulled 
 Network docker_services_cli_default  Creating
 Network docker_services_cli_default  Created
 Container docker_services_cli-postgresql-1  Creating
 Container docker_services_cli-redis-1  Creating
 Container docker_services_cli-opensearch-1  Creating
 Container docker_services_cli-opensearch-1  Created
 Container docker_services_cli-postgresql-1  Created
 Container docker_services_cli-redis-1  Created
 Container docker_services_cli-opensearch-1  Starting
 Container docker_services_cli-postgresql-1  Starting
 Container docker_services_cli-redis-1  Starting
 Container docker_services_cli-opensearch-1  Started
 Container docker_services_cli-postgresql-1  Started
 Container docker_services_cli-redis-1  Started
============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-pages/original
configfile: setup.cfg
testpaths: docs, tests, invenio_pages
plugins: invenio-4.0.0, isort-4.0.0, flask-1.3.0, github-actions-annotate-failures-0.3.0, pydocstyle-2.4.0, cov-7.0.0, black-0.6.0, pycodestyle-2.5.0
collected 39 items
tests/alembic/test_alembic.py .                                          [  2%]
tests/records/test_records.py 
                                   [ 23%]
tests/resources/test_resources.py 
::error file=workdir/tests/invenio-pages/original/tests/resources/test_resources.py,line=105::test_create%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: create
F::error file=workdir/tests/invenio-pages/original/tests/resources/test_resources.py,line=127::test_delete%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: create
F::error file=workdir/tests/invenio-pages/original/tests/resources/test_resources.py,line=148::test_update%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: update
F..::error file=workdir/tests/invenio-pages/original/tests/resources/test_resources.py,line=190::test_delete_denied%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: create
F                              [ 46%]
tests/services/test_services.py 
::error file=workdir/tests/invenio-pages/original/tests/services/test_services.py,line=110::test_create%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: create
F::error file=workdir/tests/invenio-pages/original/tests/services/test_services.py,line=128::test_delete%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: create
F::error file=workdir/tests/invenio-pages/original/tests/services/test_services.py,line=145::test_update%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: update
F..::error file=workdir/tests/invenio-pages/original/tests/services/test_services.py,line=187::test_delete_denied%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: create
F::error file=workdir/tests/invenio-pages/original/tests/services/test_services.py,line=193::test_delete_all%0A%0Ainvenio_records_resources.services.errors.PermissionDeniedError: delete
F...                            [ 79%]
tests/test_invenio_pages.py ..                                           [ 84%]
tests/test_views.py ssssss                                               [100%]
=================================== FAILURES ===================================
_________________________________ test_create __________________________________
module_scoped_pages_fixture = None, client = <FlaskClient <Flask 'invenio'>>
superuser = <pytest_invenio.user.UserFixtureBase object at 0x7f2813091a90>
    def test_create(module_scoped_pages_fixture, client, superuser):
        data = {
            "url": "/astures",
            "title": "Astures",
            "content": "Astures",
            "lang": "es",
            "description": "Los astures (astures en latín) fueron un grupo de pueblos celtas...",
            "template_name": "invenio_pages/default.html",
        }
        superuser.login(client)
>       page = client.post("/pages", json=data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/resources/test_resources.py:105: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/testing.py:235: in open
    response = super().open(
venv/lib/python3.14/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/responses.py:39: in inner
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
invenio_pages/resources/resource.py:49: in create
    page = self.service.create(
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:28: in create
    self.require_permission(identity, "create")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f2813796710>
identity = <Identity id="1" auth_type="None" provides={Need(method='role', value='superuser-access'), Need(method='system_role', value='any_user'), Need(method='id', value=1), Need(method='system_role', value='authenticated_user')}>
action_name = 'create', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: create
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
_________________________________ test_delete __________________________________
module_scoped_pages_fixture = None, client = <FlaskClient <Flask 'invenio'>>
superuser = <pytest_invenio.user.UserFixtureBase object at 0x7f2812ff1bd0>
    def test_delete(module_scoped_pages_fixture, client, superuser):
        data = {
            "url": "/cantabros",
            "title": "Cantabros",
            "content": "Cantabros",
            "lang": "es",
            "description": "El término cántabros...",
            "template_name": "invenio_pages/default.html",
        }
        superuser.login(client)
>       page = client.post("/pages", json=data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/resources/test_resources.py:127: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/testing.py:235: in open
    response = super().open(
venv/lib/python3.14/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/responses.py:39: in inner
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
invenio_pages/resources/resource.py:49: in create
    page = self.service.create(
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:28: in create
    self.require_permission(identity, "create")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f2813796710>
identity = <Identity id="2" auth_type="None" provides={Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='id', value=2), Need(method='system_role', value='authenticated_user')}>
action_name = 'create', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: create
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
_________________________________ test_update __________________________________
module_scoped_pages_fixture = None, client = <FlaskClient <Flask 'invenio'>>
admin = <pytest_invenio.user.UserFixtureBase object at 0x7f2812ff2d50>
    def test_update(module_scoped_pages_fixture, client, admin):
        data = {
            "url": "/lusitanos",
            "title": "Lusitanos",
            "content": "Lusitanos",
            "lang": "es",
            "description": "El término lusitanos...",
        }
        admin.login(client)
        assert client.get("/pages/1").json["title"] != "Lusitanos"
>       client.put("/pages/1", json=data)
tests/resources/test_resources.py:148: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/werkzeug/test.py:1172: in put
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/testing.py:235: in open
    response = super().open(
venv/lib/python3.14/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/responses.py:39: in inner
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
invenio_pages/resources/resource.py:81: in update
    page = self.service.update(
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:79: in update
    self.require_permission(identity, "update")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f2813796710>
identity = <Identity id="3" auth_type="None" provides={Need(method='id', value=3), Need(method='system_role', value='any_user'), Need(method='role', value='administration-access'), Need(method='system_role', value='authenticated_user')}>
action_name = 'update', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: update
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
______________________________ test_delete_denied ______________________________
module_scoped_pages_fixture = None, client = <FlaskClient <Flask 'invenio'>>
admin = <pytest_invenio.user.UserFixtureBase object at 0x7f2812e0f950>
superuser = <pytest_invenio.user.UserFixtureBase object at 0x7f280f30c4d0>
    def test_delete_denied(module_scoped_pages_fixture, client, admin, superuser):
        data = {
            "url": "/numantinos",
            "title": "Numantinos",
            "content": "Numantinos",
            "description": "El término numantinos...",
            "template_name": "invenio_pages/default.html",
        }
        superuser.login(client)
>       page = client.post("/pages", json=data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/resources/test_resources.py:190: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/testing.py:235: in open
    response = super().open(
venv/lib/python3.14/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.14/site-packages/flask_resources/responses.py:39: in inner
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
invenio_pages/resources/resource.py:49: in create
    page = self.service.create(
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:28: in create
    self.require_permission(identity, "create")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f2813796710>
identity = <Identity id="6" auth_type="None" provides={Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='id', value=6), Need(method='system_role', value='authenticated_user')}>
action_name = 'create', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: create
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
_________________________________ test_create __________________________________
module_scoped_pages_fixture = None
superuser_identity = <Identity id="4" auth_type="None" provides={Need(method='id', value=4), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
    def test_create(module_scoped_pages_fixture, superuser_identity):
        data = {
            "url": "/astures",
            "title": "Astures",
            "content": "Astures",
            "lang": "es",
            "description": "Los astures (astures en latín) fueron un grupo de pueblos celtas...",
            "template_name": "invenio_pages/default.html",
        }
>       page = current_pages_service.create(superuser_identity, data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/services/test_services.py:110: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:28: in create
    self.require_permission(identity, "create")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f280f330c30>
identity = <Identity id="4" auth_type="None" provides={Need(method='id', value=4), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
action_name = 'create', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: create
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
_________________________________ test_delete __________________________________
module_scoped_pages_fixture = None
superuser_identity = <Identity id="5" auth_type="None" provides={Need(method='id', value=5), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
    def test_delete(module_scoped_pages_fixture, superuser_identity):
        data = {
            "url": "/cantabros",
            "title": "Cantabros",
            "content": "Cantabros",
            "description": "El término cántabros...",
            "template_name": "invenio_pages/default.html",
        }
>       page = current_pages_service.create(superuser_identity, data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/services/test_services.py:128: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:28: in create
    self.require_permission(identity, "create")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f280f330c30>
identity = <Identity id="5" auth_type="None" provides={Need(method='id', value=5), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
action_name = 'create', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: create
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
_________________________________ test_update __________________________________
module_scoped_pages_fixture = None
admin_user_identity = <Identity id="6" auth_type="None" provides={Need(method='system_role', value='any_user'), Need(method='role', value='administration-access'), Need(method='id', value=6), Need(method='system_role', value='authenticated_user')}>
    def test_update(module_scoped_pages_fixture, admin_user_identity):
        data = {
            "url": "/lusitanos",
            "title": "Lusitanos",
            "content": "Lusitanos",
            "lang": "es",
            "description": "El término lusitanos...",
        }
        assert current_pages_service.read(admin_user_identity, 1)["title"] != "Lusitanos"
>       current_pages_service.update(admin_user_identity, data, 1)
tests/services/test_services.py:145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:79: in update
    self.require_permission(identity, "update")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f280f330c30>
identity = <Identity id="6" auth_type="None" provides={Need(method='system_role', value='any_user'), Need(method='role', value='administration-access'), Need(method='id', value=6), Need(method='system_role', value='authenticated_user')}>
action_name = 'update', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: update
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
______________________________ test_delete_denied ______________________________
module_scoped_pages_fixture = None
superuser_identity = <Identity id="9" auth_type="None" provides={Need(method='id', value=9), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
admin_user_identity = <Identity id="10" auth_type="None" provides={Need(method='id', value=10), Need(method='system_role', value='any_user'), Need(method='role', value='administration-access'), Need(method='system_role', value='authenticated_user')}>
    def test_delete_denied(
        module_scoped_pages_fixture, superuser_identity, admin_user_identity
    ):
        data = {
            "url": "/numantinos",
            "title": "Numantinos",
            "content": "Numantinos",
            "description": "El término numantinos...",
            "template_name": "invenio_pages/default.html",
        }
>       page = current_pages_service.create(superuser_identity, data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/services/test_services.py:187: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:28: in create
    self.require_permission(identity, "create")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f280f330c30>
identity = <Identity id="9" auth_type="None" provides={Need(method='id', value=9), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
action_name = 'create', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: create
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
_______________________________ test_delete_all ________________________________
module_scoped_pages_fixture = None
superuser_identity = <Identity id="11" auth_type="None" provides={Need(method='id', value=11), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
    def test_delete_all(module_scoped_pages_fixture, superuser_identity):
>       current_pages_service.delete_all(superuser_identity)
tests/services/test_services.py:193: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
venv/lib/python3.14/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_pages/services/service.py:104: in delete_all
    self.require_permission(identity, "delete")
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <invenio_pages.services.service.PageService object at 0x7f280f330c30>
identity = <Identity id="11" auth_type="None" provides={Need(method='id', value=11), Need(method='system_role', value='any_user'), Need(method='role', value='superuser-access'), Need(method='system_role', value='authenticated_user')}>
action_name = 'delete', kwargs = {}
    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy
        Like `check_permission` but raises an error if not allowed
        """
        if not self.check_permission(identity, action_name, **kwargs):
>           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: delete
venv/lib/python3.14/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError
=============================== warnings summary ===============================
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:9
    pyparsing.ParserElement.enablePackrat()
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:52
    oneThru12 = oneOf(["%.2d" % i for i in range(1, 13)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:53
    oneThru13 = oneOf(["%.2d" % i for i in range(1, 14)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:54
    oneThru23 = oneOf(["%.2d" % i for i in range(1, 24)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:55
    zeroThru23 = oneOf(["%.2d" % i for i in range(0, 24)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:56
    oneThru29 = oneOf(["%.2d" % i for i in range(1, 30)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:57
    oneThru30 = oneOf(["%.2d" % i for i in range(1, 31)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:58
    oneThru31 = oneOf(["%.2d" % i for i in range(1, 32)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:59
    oneThru59 = oneOf(["%.2d" % i for i in range(1, 60)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:60
    zeroThru59 = oneOf(["%.2d" % i for i in range(0, 60)])
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:63
    positiveDigit = Word(nums, exact=1, excludeChars="0")
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:73
    (oneOf("01 03 05 07 08 10 12")("month") + "-" + oneThru31("day"))
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:74
    ^ (oneOf("04 06 09 11")("month") + "-" + oneThru30("day"))
    p.addParseAction(cls.parse_action)
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:119
    UASymbol = Combine(oneOf("? ~ %"))
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:122
    seasonNumber = oneOf("21 22 23 24")
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:155
    l1Start.addParseAction(f)
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:157
    l1End.addParseAction(f)
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:199
    monthWithX = Combine(oneOf("0X 1X") ^ ("X" + digitOrX))("month")
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:303
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:303
    earlier = L("..").addParseAction(f)("lower") + date("upper").addParseAction(f)
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:304
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:304
    later = date("lower").addParseAction(f) + L("..").addParseAction(f)("upper")
venv/lib/python3.14/site-packages/edtf/parser/grammar.py:325
    seasonL2Number = oneOf("21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41")
tests/records/test_records.py::test_page_repr
tests/resources/test_resources.py::test_page_content
tests/services/test_services.py::test_page_read
    self.init_app(app)
tests/records/test_records.py::test_page_versions
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-pages/original/tests/records/test_records.py:29: SAWarning: nested transaction already deassociated from connection
    db.session.commit()
tests/records/test_records.py::test_create
  /home/runner/work/test-zip-extract-repository/test-zip-extract-repository/workdir/tests/invenio-pages/original/invenio_pages/records/models.py:58: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.14.2-final-0 ________________
Name                                                                    Stmts   Miss  Cover   Missing
invenio_pages/__init__.py                                                   4      0   100%
invenio_pages/administration/__init__.py                                    0      0   100%
invenio_pages/administration/views/__init__.py                              0      0   100%
invenio_pages/administration/views/pages.py                                40      0   100%
invenio_pages/alembic/08a5708005b7_change_datetime_types.py                13      0   100%
invenio_pages/alembic/9fae3c5404d9_remove_has_custom_view_to_pages.py      12      0   100%
invenio_pages/alembic/98e0a418340d_create_invenio_pages_branch.py          10      0   100%
invenio_pages/alembic/145402e8523a_create_pages_table.py                   28      0   100%
invenio_pages/alembic/1737449793_add_language_and_new_uq.py                16      0   100%
invenio_pages/alembic/__init__.py                                           0      0   100%
invenio_pages/alembic/b0f93ca4a147_add_has_custom_view_to_pages.py         14      0   100%
invenio_pages/config.py                                                    17      0   100%
invenio_pages/ext.py                                                       51      7    86%   58-66, 75
invenio_pages/proxies.py                                                    6      0   100%
invenio_pages/records/__init__.py                                           2      0   100%
invenio_pages/records/errors.py                                             7      0   100%
invenio_pages/records/models.py                                            81      3    96%   82-83, 144
invenio_pages/resources/__init__.py                                         3      0   100%
invenio_pages/resources/config.py                                          11      0   100%
invenio_pages/resources/resource.py                                        38      5    87%   53, 87, 93-99
invenio_pages/services/__init__.py                                          4      0   100%
invenio_pages/services/config.py                                           22      0   100%
invenio_pages/services/permissions.py                                       9      0   100%
invenio_pages/services/results.py                                          38      1    97%   29
invenio_pages/services/schemas.py                                          21      0   100%
invenio_pages/services/service.py                                          67     17    75%   29-39, 80-90, 95-99, 105, 118, 132
invenio_pages/views.py                                                     37     20    46%   34, 39-53, 58-65, 81-88, 105-115
TOTAL                                                                     551     53    90%
=========================== short test summary info ============================
FAILED tests/resources/test_resources.py::test_create - invenio_records_resources.services.errors.PermissionDeniedError: create
FAILED tests/resources/test_resources.py::test_delete - invenio_records_resources.services.errors.PermissionDeniedError: create
FAILED tests/resources/test_resources.py::test_update - invenio_records_resources.services.errors.PermissionDeniedError: update
FAILED tests/resources/test_resources.py::test_delete_denied - invenio_records_resources.services.errors.PermissionDeniedError: create
FAILED tests/services/test_services.py::test_create - invenio_records_resources.services.errors.PermissionDeniedError: create
FAILED tests/services/test_services.py::test_delete - invenio_records_resources.services.errors.PermissionDeniedError: create
FAILED tests/services/test_services.py::test_update - invenio_records_resources.services.errors.PermissionDeniedError: update
FAILED tests/services/test_services.py::test_delete_denied - invenio_records_resources.services.errors.PermissionDeniedError: create
FAILED tests/services/test_services.py::test_delete_all - invenio_records_resources.services.errors.PermissionDeniedError: delete
============= 9 failed, 24 passed, 6 skipped, 47 warnings in 6.04s =============
 Container docker_services_cli-opensearch-1  Stopping
 Container docker_services_cli-postgresql-1  Stopping
 Container docker_services_cli-redis-1  Stopping
 Container docker_services_cli-redis-1  Stopped
 Container docker_services_cli-redis-1  Removing
 Container docker_services_cli-postgresql-1  Stopped
 Container docker_services_cli-postgresql-1  Removing
 Container docker_services_cli-opensearch-1  Stopped
 Container docker_services_cli-opensearch-1  Removing
 Container docker_services_cli-opensearch-1  Removed
 Container docker_services_cli-postgresql-1  Removed
 Container docker_services_cli-redis-1  Removed
 Network docker_services_cli_default  Removing
 Network docker_services_cli_default  Removed
